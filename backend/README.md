# Backend

This is the project containing the Java source files of the application backend, as well as the 
[Thymeleaf](https://www.thymeleaf.org) templates used to generate the HTML pages.

The backend is based on Spring Boot, and uses

 - Spring MVC for the web layer
 - Thymeleaf as the template engine to render the pages
 - Spring JDBC for the database access layer
 - FlywayDB to generate and migrate the database schema when the application starts
 - JUnit 5, Mockito and AssertJ for the automated tests
 
## JavaScript and CSS

The JavaScript and CSS files of the public-facing application are generated by the 
[frontend](../frontend/README.md) project.

The JavaScript and CSS files of the administration application are generated by the 
[admin](../admin/README.md) project.

During development, it's advised to

 - run `yarn watch` from the frontend directory to generate the JS and
   CSS files (see the [frontend README](../frontend/README.md) for details); 
 - run `ng serve` from the admin directory to generate the JS and
   CSS files (see the [admin README](../admin/README.md) for details); 
 - to execute the backend application using the `dev` profile,
   from the root directory. The task `./gradlew bootRun` does that by itself.

This `dev` profile includes the `frontend/build/dist` directory in the list of static resources locations,
so that the JavaScript and CSS files generated by `yarn watch` are available to the templates.
It also uses the `images` directory as the location of uploaded images.

Example data for development can be inserted in the database using the `database/testing/test-data.sql` script.
See the [database README](./database/README.md) for details. The data located in this SQL file refers to images
located in the `images` directory.

This `images` directory is a symbolic link to `../biom-backup/diversity/data`. In order to have that directory
available, you need to execute the following comands, from the parent directory of this project (so that
`biom-backup` is a sibling of `diversity`):

```bash
git clone https://outils-patrinat.mnhn.fr/gitlab/biom/biom-backup.git
git checkout dev-data
```

For production, Gradle builds the JavaScript and CSS in production mode (minified) and includes
the generated files inside the generated application jar file.

The Spring resource chain is used at runtime in order to rewrite the paths to those files
with a content hash in their name, and to instruct the browser to cache those files.
